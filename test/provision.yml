---
- name: Test connection
  hosts: all
  gather_facts: true
  become: true
  vars:
    log4j: https://archive.apache.org/dist/logging/log4j/2.7/apache-log4j-2.7-bin.tar.gz
    mydest: "/var/www/test-log4j"

  tasks:
    - name: Test connection
      ping:

    - name: Create the user devops as a member of the group wheel
      user:
        group: wheel
        name: devops

    - name: Install the sudo configuration which allows passwordless execution of command as root
      copy:
        src: devops.sudo
        dest: /etc/sudoers.d/devops

    - name: Authorize the ssh key devops
      authorized_key:
        manage_dir: true
        user: devops
        key: "{{ lookup('file', '~/.ssh/id_rsa.pub') }}"

    - name: extractor presents
      ansible.builtin.yum:
        name:
          - unzip
          - tar
        state: present

    - name: destination present
      ansible.builtin.file:
        path: "{{ mydest }}"
        state: directory
        owner: root
        group: root
        mode: '0755'

    - name: extract archive
      ansible.builtin.unarchive:
        src: "{{ log4j }}"
        dest: "{{ mydest }}"
        remote_src: true
        validate_certs: true
        mode: '0644'
        owner: root
        group: root
